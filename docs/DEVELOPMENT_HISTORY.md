# FileView Development History

FileView の開発履歴 - ゼロから現在までの全記録

## Overview

```
2026年1月28日  v0.11.0  最初の公開リリース
     ↓
2026年1月30日  v1.0.0   安定版リリース
     ↓
2026年1月31日  v1.18.0  フル機能版
     ↓
2026年2月3日   v1.22.0  Luaプラグイン完成
```

---

## Phase 1: 誕生 (v0.11.0 - v1.0.0)

### v0.11.0 - 2026年1月28日 🎉 初回リリース

**FileView が世に出た日**

最初の公開リリース。基本機能を実装:

- ファイルツリー表示（Vim風キーバインド: j/k/h/l）
- 画像プレビュー（Kitty, iTerm2, Sixel プロトコル対応）
- Git ステータス表示（色分け）
- ファジーファインダー（Ctrl+P）
- ファイル操作（作成、削除、リネーム、コピー、移動）
- Pick モード（シェル連携用）
- Nerd Fonts アイコン対応
- マウスサポート

### v0.11.1 - 2026年1月30日

- ヘルプメッセージの説明を改善

### v1.0.0 - 2026年1月30日 🎯 安定版

**正式リリース - API の確定**

- 遅延 Git ステータス検出で起動高速化
- ツリー読み込み最適化（stat() 呼び出し削減）
- 終了コードの統一
  - 0: 成功
  - 1: キャンセル（Pick モード）
  - 2: 実行時エラー
  - 3: 無効な引数
- エラーメッセージの改善

### v1.0.1 - 2026年1月30日

- `?` キーでヘルプをポップアップ表示に変更（ステータスバーでの切り詰め問題を解決）

---

## Phase 2: 基盤強化 (v1.1.0 - v1.4.0)

### v1.1.0 - 2026年1月30日 📥 stdin 対応

**パイプライン統合**

- `--stdin` オプション追加
- `find . -name "*.rs" | fv --stdin --pick` のようなパイプライン連携が可能に
- stdin モードではファイル操作を自動無効化

### v1.2.0 - 2026年1月30日 👁️ ファイル監視

**リアルタイム更新**

- `notify` crate によるファイル監視
- ファイル変更時に自動リフレッシュ
- 500ms デバウンス処理
- ステータスバーに監視アイコン（）表示

### v1.2.1 - 2026年1月30日

- ファイルウォッチャーのパフォーマンス問題を修正（イベントをドレインして重複リロード防止）

### v1.2.2 - 2026年1月30日

- 大きなディレクトリ（`.git`, `target`, `node_modules` 等）を監視対象から除外

### v1.3.0 - 2026年1月30日 🧠 スマート監視

**効率的なリソース使用**

- 展開されたディレクトリのみを監視
- Git ステータスは 3 秒ごとにポーリング
- 大規模プロジェクトでのリソース使用量を大幅削減

### v1.4.0 - 2026年1月30日 🧪 テスト強化

**品質向上**

- E2E テストスイート追加（21 テスト）
- CLI 動作、エラーハンドリング、stdin モードをカバー
- `docs/KEYBINDINGS.md` - 完全なキーバインドリファレンス作成
- README 改善（バッジ追加、簡潔化）

---

## Phase 3: ユーザビリティ (v1.5.0 - v1.8.0)

### v1.5.0 - 2026年1月31日 🏗️ 大規模リファクタリング

**コードベースの再構築**

- `handler/action.rs`（2,853行）をモジュール分割
  - `navigation.rs` - ナビゲーション
  - `tree_ops.rs` - ツリー操作
  - `selection.rs` - 選択とクリップボード
  - `file_ops.rs` - ファイル操作
  - `search.rs` - 検索
  - `input.rs` - 入力処理
  - `display.rs` - 表示制御
- `main.rs`（991行）を `src/app/` モジュールに分割
  - `config.rs` - CLI 設定
  - `preview.rs` - プレビュー状態
  - `event_loop.rs` - イベントループ
  - `render.rs` - レンダリング

### v1.6.0 - 2026年1月31日 📑 ブックマーク & フィルター

**ナビゲーション強化**

- ブックマーク機能
  - `m1`-`m9`: ブックマーク設定
  - `'1`-`'9`: ブックマークへジャンプ
- ファイルフィルター
  - `F`: フィルター入力/クリア
  - glob パターン対応（`*.rs`, `test*`）

### v1.6.1 - 2026年1月31日

- モード開始キーでトグル終了できるように改善（`/` で検索開始、再度 `/` でキャンセル）

### v1.6.2 - 2026年1月31日

- キーバインドドキュメント更新
- トグル動作のテスト追加（15 テスト）

### v1.6.3 - 2026年1月31日

- 矢印キー（←/→）でツリー/プレビュー間のフォーカス切り替え

### v1.7.0 - 2026年1月31日 📊 ステータスバー刷新

**情報表示の改善**

- ファイルサイズ表示（例: `1.2 KB`, `4.5 MB`）
- 相対的な更新日時（例: `2h ago`, `Yesterday`）
- 位置インジケータ（`1/20`）を削除

### v1.7.1 - 2026年1月31日

- パフォーマンス最適化
  - Git ポーリング: 3秒 → 5秒
  - イベントポーリング: 50ms → 100ms
  - Git status: `-unormal` オプション使用

### v1.7.2 - 2026年1月31日

- `-uall` フラグを復元（個別のファイル表示のため）
- イベントポーリングを 60ms に調整（バランス重視）

### v1.8.0 - 2026年1月31日 🔄 ソート & 検索強化

**操作性向上**

- ソートモード切り替え（`S` キー）
  - Name（デフォルト）
  - Size（大きい順）
  - Date（新しい順）
- 検索マッチ数表示（`3/12 matches`）
- 逆方向検索（`N` キー）

---

## Phase 4: プレビュー拡張 (v1.9.0 - v1.14.0)

### v1.9.0 - 2026年1月31日 📦 アーカイブプレビュー

**圧縮ファイル対応**

- Zip アーカイブの内容をプレビュー
- 対応形式: `.zip`, `.jar`, `.apk`, `.ipa`, `.xpi`, `.epub`
- `docs/BENCHMARKS.md` 追加（起動時間 ~2.1ms）

### v1.9.1 - 2026年1月31日

- アーカイブプレビューのキーボードスクロール修正
- Hex プレビューのスクロール修正
- マウススクロール対応

### v1.9.2 - 2026年1月31日

- プレビュースクロールの境界チェック修正（無限スクロール防止）

### v1.10.0 - 2026年1月31日 📦 tar.gz 対応

- tar.gz アーカイブプレビュー追加
- `tar` + `flate2` crate 使用

### v1.11.0 - 2026年1月31日 🗑️ ゴミ箱対応

**安全な削除**

- ファイル削除がシステムのゴミ箱に移動するように変更
- `trash` crate によるクロスプラットフォーム対応
- 復元可能な削除操作

### v1.11.1 - 2026年1月31日

- アーカイブソートロジックをリファクタリング
- ブックマークモジュールのテスト追加

### v1.11.2 - 2026年1月31日

- マウスモジュールのテスト追加（29 テスト）

### v1.11.3 - 2026年1月31日

- E2E テスト拡充（16 新規、計 37 テスト）

### v1.12.0 - 2026年1月31日 🔒 セキュリティ強化

**脆弱性対策**

- `--stdin` モードでのパストラバーサル防止
- Git コマンドの PATH ハードニング
- TOCTOU 軽減（ファイルコピー時の競合状態対策）
- `docs/SECURITY.md` 追加

### v1.13.0 - 2026年1月31日 📄 PDF プレビュー

**ドキュメント対応**

- poppler-utils による PDF レンダリング
- ページナビゲーション（`[` / `]` キー）
- 150 DPI でレンダリング
- `tempfile` crate による一時ファイル管理

### v1.14.0 - 2026年1月31日 🎨 シンタックスハイライト

**コード表示の美化**

- `syntect` crate（bat/delta と同じエンジン）
- 100+ 言語対応
- base16-ocean.dark テーマ

### v1.14.1 - 2026年1月31日

- MSRV バッジを 1.75 に更新
- Clippy 警告を修正

### v1.14.2 - 2026年1月31日

- tar.gz の日付表示バグ修正
- ブックマークキー処理の安全性向上

### v1.14.3 - 2026年1月31日

- アーカイブ DoS 防止（エントリ名 4KB 制限）
- コードリファクタリング

### v1.14.4 - 2026年1月31日

- README 改善（ポジショニング図、競合比較）
- `docs/COMPARISON.md` 追加

---

## Phase 5: カスタマイズ (v1.15.0 - v1.18.0)

### v1.15.0 - 2026年1月31日 ⚡ Git 操作 & 非同期処理

**パワーユーザー向け機能**

- 非同期画像読み込み（std::thread + mpsc）
- Git stage/unstage（`s` / `u` キー）
- Git diff プレビュー（色分け表示）
- バルクリネーム（`R` キー、パターン置換）
- タブ基盤の実装

### v1.15.1 - 2026年1月31日

- テストスイート拡充（93 新規テスト）
  - bulk_rename, tab, git diff, git operations

### v1.16.0 - 2026年1月31日 ⚙️ 設定システム

**フルカスタマイズ対応**

- 設定ファイル: `~/.config/fileview/config.toml`
- キーマップ: `keymap.toml`
- テーマ: `theme.toml`
- CLI オプション `--hidden` / `--no-hidden`

### v1.17.0 - 2026年1月31日 🔧 カスタムコマンド

**拡張性向上**

- カスタムコマンド定義（`[commands]` セクション）
- プレースホルダー: `$f`, `$d`, `$n`, `$s`, `$e`, `$S`
- カスタムプレビュー（外部スクリプト連携）
- ドキュメント追加: `CONFIGURATION.md`, `THEMES.md`, `COMMANDS.md`

### v1.18.0 - 2026年2月3日 🚀 フル機能版

**v3 完成**

- **動画プレビュー**: ffmpeg 連携、サムネイル + メタデータ
- **タブサポート**: `Ctrl+T`（新規）、`Ctrl+W`（閉じる）、`Alt+t/T`（切り替え）
- **イベントフック**: `on_create`, `on_delete`, `on_rename`, `on_cd`, `on_start`, `on_exit`
- **シェル連携強化**: `--choosedir`, `--selection-path`, `Alt+S`（サブシェル）
- **バッチ操作**: Visual Select モード（`V`）、全選択（`*`）、反転（`Alt+i`）

---

## Phase 6: プラグインシステム (v1.19.0 - v1.22.0)

### v1.19.0 - 2026年2月3日 🔌 Lua ランタイム

**Phase 12a: プラグイン基盤**

- Lua 5.4 統合（`mlua` crate）
- プラグイン場所: `~/.config/fileview/plugins/init.lua`
- 読み取り専用 API:
  - `fv.current_file()`, `fv.current_dir()`
  - `fv.selected_files()`, `fv.version()`
  - `fv.is_dir()`, `fv.file_exists()`
  - `fv.notify()`

### v1.20.0 - 2026年2月3日 🎬 アクション API

**Phase 12b: 操作機能**

- アクション関数:
  - `fv.navigate(path)`
  - `fv.select(path)`, `fv.deselect(path)`
  - `fv.clear_selection()`
  - `fv.refresh()`
  - `fv.set_clipboard(text)`
  - `fv.focus(path)`
- アクションはキューに入れられ、イベントループで処理

### v1.21.0 - 2026年2月3日 📝 登録 API

**Phase 12c: 拡張ポイント**

- `fv.register_command(name, fn)`: カスタムコマンド登録
- `fv.on(event, fn)`: イベントハンドラ登録
- `fv.register_previewer(pattern, fn)`: カスタムプレビューア登録
- 同一イベントに複数ハンドラ登録可能

### v1.22.0 - 2026年2月3日 ✨ プラグイン完成

**Phase 12d: 統合完了**

- 起動時に自動でプラグイン読み込み
- イベント自動発火:
  - `start`: プラグイン読み込み後
  - `file_selected`: フォーカスファイル変更時
  - `directory_changed`: ディレクトリ移動時
  - `selection_changed`: 複数選択変更時
  - `before_quit`: 終了前
- プラグインアクションをフレームごとに処理
- 通知をステータスバーに表示

---

## 統計

### バージョン数

| フェーズ | バージョン数 | 期間 |
|----------|-------------|------|
| Phase 1 (誕生) | 4 | 1月28日-30日 |
| Phase 2 (基盤) | 6 | 1月30日 |
| Phase 3 (UX) | 10 | 1月31日 |
| Phase 4 (プレビュー) | 12 | 1月31日 |
| Phase 5 (カスタマイズ) | 5 | 1月31日-2月3日 |
| Phase 6 (プラグイン) | 4 | 2月3日 |
| **合計** | **41 リリース** | **7 日間** |

### コード成長

| バージョン | 概算行数 | 増加 |
|-----------|---------|------|
| v0.11.0 | ~5,000 | - |
| v1.0.0 | ~6,000 | +1,000 |
| v1.5.0 | ~7,000 | +1,000 |
| v1.14.0 | ~10,000 | +3,000 |
| v1.18.0 | ~15,000 | +5,000 |
| v1.22.0 | ~18,000 | +3,000 |

### テスト数

| バージョン | テスト数 |
|-----------|---------|
| v1.0.0 | ~100 |
| v1.4.0 | ~120 |
| v1.14.0 | ~340 |
| v1.15.1 | ~430 |
| v1.22.0 | ~450 |

### 追加された依存関係

| バージョン | Crate | 用途 |
|-----------|-------|------|
| v1.2.0 | `notify` | ファイル監視 |
| v1.9.0 | `zip` | アーカイブプレビュー |
| v1.10.0 | `tar`, `flate2` | tar.gz 対応 |
| v1.11.0 | `trash` | ゴミ箱操作 |
| v1.13.0 | `tempfile` | PDF 一時ファイル |
| v1.14.0 | `syntect` | シンタックスハイライト |
| v1.16.0 | `toml`, `dirs`, `serde` | 設定システム |
| v1.19.0 | `mlua` | Lua プラグイン |

---

## 設計原則

開発を通じて維持した原則:

1. **シンプル** - 必要な機能に絞る
2. **高速** - 起動 < 50ms
3. **ゼロ設定** - インストール後すぐ使える
4. **バッテリー同梱** - 画像、Git、シンタックスハイライト内蔵

---

## リンク

- [CHANGELOG.md](../CHANGELOG.md) - 詳細な変更履歴
- [PLUGINS.md](PLUGINS.md) / [PLUGINS_ja.md](PLUGINS_ja.md) - プラグインドキュメント
- [COMPARISON.md](COMPARISON.md) - 競合比較
